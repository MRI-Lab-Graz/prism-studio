<!-- Test HTML file for color rendering -->
<!DOCTYPE html>
<html>
<head>
    <title>ANSI Color Test</title>
    <style>
        body { background: #1e1e1e; color: #cccccc; font-family: monospace; padding: 20px; }
        .terminal { background: #1e1e1e; color: #cccccc; padding: 15px; border-radius: 5px; }
        .ansi-red { color: #ff5555; }
        .ansi-yellow { color: #ffff55; }
        .ansi-green { color: #55ff55; }
        .ansi-blue { color: #5555ff; }
        .ansi-cyan { color: #55ffff; }
        .ansi-reset { color: #cccccc; }
    </style>
</head>
<body>
    <div class="terminal" id="output"></div>
    <script>
        function ansiToHtml(text) {
            if (!text) return '';
            
            // Escape HTML special characters first
            let html = text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
            
            // Replace ANSI codes with HTML spans
            const ansiRegex = /\x1b\[([0-9;]+)m/g;
            
            html = html.replace(ansiRegex, (match, code) => {
                switch (code) {
                    case '91':  return '</span><span class="ansi-red">';
                    case '93':  return '</span><span class="ansi-yellow">';
                    case '92':  return '</span><span class="ansi-green">';
                    case '94':  return '</span><span class="ansi-blue">';
                    case '96':  return '</span><span class="ansi-cyan">';
                    case '0':   return '</span><span class="ansi-reset">';
                    default:    return match;
                }
            });
            
            // Clean up: remove opening span at start
            html = html.replace(/^<\/span>/, '');
            
            // Close any remaining open spans
            const openCount = (html.match(/<span/g) || []).length;
            const closeCount = (html.match(/<\/span>/g) || []).length;
            for (let i = closeCount; i < openCount; i++) {
                html += '</span>';
            }
            
            return html;
        }
        
        // Test data with ANSI codes (as they come from Python/JSON)
        const testMessages = [
            "\x1b[94m[INFO]\x1b[0m ðŸ“‚ Scanning source folder: input",
            "\x1b[94m[INFO]\x1b[0m DRY RUN MODE - No files will be written",
            "\x1b[94m[INFO]\x1b[0m ðŸ“ File: sub-17_ses-1_task-gaze_eyetracking.tsv",
            "\x1b[93m[WARNING]\x1b[0m âš ï¸ Invalid filename pattern",
            "\x1b[92m[SUCCESS]\x1b[0m âœ“ Renamed columns: AVERAGE_GAZE_Xâ†’x_coordinate",
            "\x1b[96m[PREVIEW]\x1b[0m ðŸ“‹ Output preview (first 8 rows):",
            "\x1b[96m[PREVIEW]\x1b[0m timestamp | x_coordinate | y_coordinate | pupil_size",
            "\x1b[91m[ERROR]\x1b[0m âŒ TSV processing error: file not found"
        ];
        
        const output = document.getElementById('output');
        output.innerHTML = testMessages.map(msg => ansiToHtml(msg)).join('<br>');
    </script>
</body>
</html>
