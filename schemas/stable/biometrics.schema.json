{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://prism.org/schemas/biometrics/v1.1.0",
  "version": "1.1.0",
  "title": "Biometrics Metadata",
  "description": "Schema for biometric and physical performance assessment data (e.g., VO2max, planks, balance, grip strength). Files should be named: sub-<label>[_ses-<label>]_biometrics-<label>[_run-<index>]_biometrics.<tsv|json>",
  "type": "object",
  "properties": {
    "Technical": {
      "type": "object",
      "description": "Technical biometric properties",
      "properties": {
        "Type": {
          "type": "string",
          "enum": ["Biometrics", "PhysicalPerformance", "Anthropometry", "FitnessTest"],
          "description": "Type of biometric assessment"
        },
        "FileFormat": {
          "type": "string",
          "enum": ["tsv"],
          "description": "Data file format"
        },
        "Equipment": {
          "type": "string",
          "description": "Equipment used for measurement (e.g., Stopwatch, Cycle Ergometer, Dynamometer)"
        },
        "EquipmentManufacturer": {
          "type": "string",
          "description": "Manufacturer of the equipment"
        },
        "EquipmentModel": {
          "type": "string", 
          "description": "Model name/number of the equipment"
        },
        "CalibrationDate": {
          "type": "string",
          "format": "date",
          "description": "Date of last equipment calibration"
        },
        "Supervisor": {
          "type": "string",
          "enum": ["investigator", "physician", "trainer", "physiotherapist", "self"],
          "description": "Who supervised the assessment"
        },
        "Location": {
          "type": "string",
          "enum": ["laboratory", "clinic", "gym", "field", "home"],
          "description": "Where the assessment was conducted"
        }
      },
      "required": ["Type", "FileFormat", "Equipment"]
    },
    "I18n": {
      "type": "object",
      "description": "Internationalization settings for multi-language biometrics",
      "properties": {
        "Languages": {
          "type": "array",
          "items": {"type": "string", "pattern": "^[a-z]{2}(-[A-Z]{2})?$"},
          "description": "List of available languages (e.g., ['en', 'de', 'fr'])"
        },
        "DefaultLanguage": {
          "type": "string",
          "pattern": "^[a-z]{2}(-[A-Z]{2})?$",
          "description": "Default/primary language of the instrument"
        },
        "TranslationMethod": {
          "type": "string",
          "enum": ["forward-backward", "committee", "parallel", "original", "validated-translation"],
          "description": "Method used for translation validation"
        }
      }
    },
    "Study": {
      "type": "object",
      "description": "Study-specific assessment parameters",
      "properties": {
        "BiometricName": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9]+$",
          "description": "Short biometric identifier matching filename (e.g., vo2max, planks, grip)"
        },
        "OriginalName": {
          "type": ["string", "object"],
          "description": "Full name of the test (e.g., UKK Walk Test, Plank Test, Handgrip Strength)"
        },
        "ShortName": {
          "type": ["string", "object"],
          "description": "Common abbreviation (e.g., VO2max, 6MWT)"
        },
        "Authors": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Authors of the test protocol"
        },
        "Citation": {
          "type": "string",
          "description": "DOI or citation for the test protocol"
        },
        "DOI": {
          "type": "string",
          "description": "Digital Object Identifier (DOI) for the test protocol"
        },
        "Category": {
          "type": "string",
          "enum": ["cardiorespiratory", "muscular-strength", "muscular-endurance", "flexibility", "balance", "body-composition", "anthropometry"],
          "description": "Category of fitness/biometric test"
        },
        "Protocol": {
          "type": "string",
          "description": "Reference to the protocol used"
        },
        "Keywords": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Keywords describing the test"
        },
        "Description": {
          "type": ["string", "object"],
          "description": "Detailed description of the test procedure"
        },
        "Reliability": {
          "type": ["string", "object"],
          "description": "Information about the reliability of the test"
        },
        "Validity": {
          "type": ["string", "object"],
          "description": "Information about the validity of the test"
        },
        "Instructions": {
          "type": ["string", "object"],
          "description": "Instructions given to the participant"
        },
        "Author": {
          "type": "string",
          "description": "Author(s) of the test protocol"
        },
        "DOI": {
          "type": "string",
          "description": "DOI of the reference publication"
        },
        "Reference": {
          "type": "string",
          "description": "Citation or reference for the test protocol"
        },
        "EstimatedDuration": {
          "type": "string",
          "description": "Estimated time to complete the assessment (e.g., '15 minutes')"
        },
        "TargetPopulation": {
          "type": "string",
          "description": "Intended population for the test (e.g., 'Adults 18-65', 'Children')"
        },
        "ExclusionCriteria": {
          "type": "string",
          "description": "Conditions under which the test should not be performed"
        },
        "WarmupProtocol": {
          "type": "string",
          "description": "Warmup procedure before the test (if required)"
        }
      },
      "required": ["BiometricName", "OriginalName", "Description"]
    },
    "Normative": {
      "type": "object",
      "description": "Normative data and reference values",
      "properties": {
        "ReferencePopulation": {
          "type": "string",
          "description": "Population on which normative data is based"
        },
        "ReferenceSource": {
          "type": "string",
          "description": "Citation for normative data"
        },
        "Percentiles": {
          "type": "object",
          "description": "Percentile cutoffs (e.g., {'p25': 10, 'p50': 15, 'p75': 20})"
        }
      }
    },
    "Metadata": {
      "type": "object",
      "description": "Administrative metadata",
      "properties": {
        "SchemaVersion": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "CreationDate": {
          "type": "string",
          "format": "date"
        },
        "Creator": {
          "type": "string"
        }
      },
      "required": ["SchemaVersion", "CreationDate"]
    }
  },
  "required": ["Technical", "Study", "Metadata"],
  "additionalProperties": {
    "type": "object",
    "properties": {
      "Description": {
        "type": ["string", "object"],
        "description": "Description of the metric"
      },
      "Units": {
        "type": "string",
        "description": "Unit of measurement (e.g., kg, sec, ml/kg/min)"
      },
      "MinValue": {
        "type": "number",
        "description": "Minimum allowed value for this column"
      },
      "MaxValue": {
        "type": "number",
        "description": "Maximum allowed value for this column"
      },
      "WarnMinValue": {
        "type": "number",
        "description": "Minimum value threshold for warning"
      },
      "WarnMaxValue": {
        "type": "number",
        "description": "Maximum value threshold for warning"
      },
      "AllowedValues": {
        "type": "array",
        "items": {
          "type": ["string", "number"]
        },
        "description": "List of allowed values for this column"
      },
      "Levels": {
        "type": "object",
        "description": "Optional mapping of coded values to human-readable labels (e.g., Likert scales)",
        "patternProperties": {
          "^.*$": { "type": ["string", "object"] }
        }
      },
      "DataType": {
        "type": "string",
        "enum": ["string", "integer", "float"],
        "description": "Expected data type for this column"
      },
      "SessionHint": {
        "type": "string",
        "pattern": "^ses-[a-zA-Z0-9]+$",
        "description": "Optional session hint for repeated assessments (e.g., 'ses-1')"
      },
      "RunHint": {
        "type": "string",
        "pattern": "^run-[a-zA-Z0-9]+$",
        "description": "Optional run hint for repeated assessments (e.g., 'run-2')"
      }
    },
    "required": ["Description", "Units"]
  }
}
