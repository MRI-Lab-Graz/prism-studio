{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://prism.org/schemas/survey/v1.1.1",
  "version": "1.1.1",
  "title": "Survey Data Metadata",
  "description": "Schema for questionnaire and survey data. Files should be named: sub-<label>[_ses-<label>]_survey-<label>[_acq-<label>][_run-<index>]_survey.<tsv|json>",
  "type": "object",
  "properties": {
    "Technical": {
      "type": "object",
      "description": "Technical survey properties",
      "properties": {
        "StimulusType": {
          "type": "string",
          "enum": ["Questionnaire", ""],
          "description": "Must be 'Questionnaire' for survey data"
        },
        "FileFormat": {
          "type": "string",
          "enum": ["tsv", ""],
          "description": "Survey data file format"
        },
        "SoftwarePlatform": {
          "type": "string",
          "description": "Software platform used for data collection (e.g., LimeSurvey, REDCap, Qualtrics)"
        },
        "SoftwareVersion": {
          "type": "string",
          "description": "Version of the survey software platform"
        },
        "Language": {
          "type": "string",
          "pattern": "^([a-z]{2}(-[A-Z]{2})?)?$",
          "description": "Language of the questionnaire (e.g., en, en-US, de-AT)"
        },
        "Respondent": {
          "type": "string",
          "enum": ["self", "clinician", "parent", "teacher", "caregiver", "other", ""],
          "description": "Who provided the responses"
        },
        "AdministrationMethod": {
          "type": "string",
          "enum": ["online", "paper", "interview", "phone", "mixed", ""],
          "description": "How the survey was administered"
        },
        "ResponseType": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Input/response modality (e.g., paper-pencil, button, slider, keyboard, voice, mixed)"
        },
        "Equipment": {
          "type": "string",
          "description": "Equipment used for measurement (e.g., Stopwatch, Cycle Ergometer, Dynamometer)"
        },
        "EquipmentManufacturer": {
          "type": "string",
          "description": "Manufacturer of the equipment"
        },
        "EquipmentModel": {
          "type": "string", 
          "description": "Model name/number of the equipment"
        },
        "CalibrationDate": {
          "type": "string",
          "pattern": "^(\\d{4}-\\d{2}-\\d{2})?$",
          "description": "Date of last equipment calibration"
        },
        "Supervisor": {
          "type": "string",
          "enum": ["investigator", "physician", "trainer", "physiotherapist", "self", ""],
          "description": "Who supervised the assessment"
        },
        "Location": {
          "type": "string",
          "enum": ["laboratory", "clinic", "gym", "field", "home", ""],
          "description": "Where the assessment was conducted"
        }
      },
      "required": ["StimulusType", "FileFormat", "Language", "Respondent"]
    },
    "I18n": {
      "type": "object",
      "description": "Internationalization settings for multi-language surveys",
      "properties": {
        "Languages": {
          "type": "array",
          "items": {"type": "string", "pattern": "^([a-z]{2}(-[A-Z]{2})?)?$"},
          "description": "List of available languages (e.g., ['en', 'de', 'fr'])"
        },
        "DefaultLanguage": {
          "type": "string",
          "pattern": "^([a-z]{2}(-[A-Z]{2})?)?$",
          "description": "Default/primary language of the instrument"
        },
        "TranslationMethod": {
          "type": "string",
          "enum": ["forward-backward", "committee", "parallel", "original", "validated-translation", ""],
          "description": "Method used for translation validation"
        }
      }
    },
    "Study": {
      "type": "object",
      "description": "Study-specific survey parameters",
      "properties": {
        "TaskName": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9]*$",
          "description": "Short task identifier matching filename (e.g., bdi, phq9, dass21)"
        },
        "OriginalName": {
          "type": ["string", "object"],
          "description": "Full canonical name of the instrument (e.g., Beck Depression Inventory)"
        },
        "ShortName": {
          "type": ["string", "object"],
          "description": "Common abbreviation (e.g., BDI-II, PHQ-9)"
        },
        "Version": {
          "type": ["string", "object"],
          "description": "Version of the instrument (e.g., II, 5.0, 21-item)"
        },
        "Authors": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Authors of the instrument"
        },
        "Citation": {
          "type": "string",
          "description": "DOI or citation for the instrument"
        },
        "DOI": {
          "type": "string",
          "description": "Digital Object Identifier (DOI) for the instrument"
        },
        "License": {
          "type": "string",
          "description": "License statement for this instrument as provided by the source registry"
        },
        "LicenseID": {
          "type": "string",
          "description": "Normalized license identifier when available (e.g., CC-BY-NC-ND-3.0)"
        },
        "LicenseURL": {
          "type": "string",
          "format": "uri",
          "description": "License URL when available (e.g., creativecommons.org link)"
        },
        "CopyrightHolder": {
          "type": "string",
          "description": "Rights holder for the instrument (e.g., publisher, author group)"
        },
        "Access": {
          "type": "string",
          "enum": ["public", "permission-required", "licensed", "unknown", ""],
          "description": "High-level access/permission classification for transparency"
        },
        "PermissionsNote": {
          "type": ["string", "object"],
          "description": "Short note describing permissions/usage constraints"
        },
        "PermissionsURL": {
          "type": "string",
          "description": "URL to permission statement or licensing portal"
        },
        "TermURL": {
          "type": "string",
          "format": "uri",
          "description": "URL to formal definition (e.g., PhenX, SNOMED)"
        },
        "Construct": {
          "type": ["string", "object"],
          "description": "Primary psychological construct measured (e.g., depression, anxiety, stress)"
        },
        "Keywords": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Keywords describing the instrument"
        },
        "Description": {
          "type": ["string", "object"],
          "description": "Detailed description or abstract of the instrument"
        },
        "Instructions": {
          "type": ["string", "object"],
          "description": "Instructions given to the participant"
        },
        "Instruction": {
          "type": ["string", "object"],
          "description": "Instructions given to the participant (alias for Instructions)"
        },
        "Reliability": {
          "type": ["string", "object"],
          "description": "Information about the reliability of the instrument"
        },
        "Validity": {
          "type": ["string", "object"],
          "description": "Information about the validity of the instrument"
        },
        "Subscales": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of subscale names if applicable"
        },
        "ItemCount": {
          "type": ["integer", "null"],
          "description": "Number of items in the instrument"
        },
        "AgeRange": {
          "type": ["string", "object"],
          "description": "Target age range for the instrument"
        },
        "AdministrationTime": {
          "type": ["string", "object"],
          "description": "Estimated time to complete the instrument"
        },
        "ScoringTime": {
          "type": ["string", "object"],
          "description": "Estimated time to score the instrument"
        },
        "Norming": {
          "type": ["string", "object"],
          "description": "Information about the norming of the instrument"
        },
        "References": {
          "type": "array",
          "description": "Structured reference list for the instrument (primary paper, manual, translation, norms, validation, etc.)",
          "items": {
            "type": "object",
            "properties": {
              "Type": {
                "type": "string",
                "enum": ["primary", "manual", "translation", "validation", "norms", "other", ""],
                "description": "Reference type"
              },
              "Citation": {
                "type": "string",
                "description": "Human-readable citation"
              },
              "DOI": {
                "type": "string",
                "description": "DOI for the reference"
              },
              "URL": {
                "type": "string",
                "description": "URL for the reference"
              },
              "Year": {
                "type": ["integer", "null"],
                "description": "Publication year"
              },
              "Notes": {
                "type": ["string", "object"],
                "description": "Optional notes about the reference"
              }
            }
          }
        },
        "Translation": {
          "type": "object",
          "description": "Translation/adaptation provenance (especially for non-original language versions)",
          "properties": {
            "SourceLanguage": {
              "type": "string",
              "pattern": "^([a-z]{2}(-[A-Z]{2})?)?$",
              "description": "Source language of the instrument"
            },
            "TargetLanguage": {
              "type": "string",
              "pattern": "^([a-z]{2}(-[A-Z]{2})?)?$",
              "description": "Target language used in this dataset"
            },
            "Validated": {
              "type": "boolean",
              "description": "Whether this translation/adaptation is validated"
            },
            "Method": {
              "type": "string",
              "description": "Translation/adaptation method (if different from I18n.TranslationMethod)"
            },
            "Reference": {
              "type": "string",
              "description": "Citation/DOI/URL for the translation/adaptation reference"
            },
            "Notes": {
              "type": ["string", "object"],
              "description": "Additional provenance notes"
            }
          }
        }
      },
      "required": ["TaskName", "OriginalName"]
    },
    "Scoring": {
      "type": "object",
      "description": "Scoring and interpretation information",
      "properties": {
        "ScoringMethod": {
          "type": "string",
          "description": "How items are scored (e.g., sum, mean, weighted)"
        },
        "ScoreRange": {
          "type": "object",
          "properties": {
            "min": {"type": ["number", "null"]},
            "max": {"type": ["number", "null"]}
          },
          "description": "Possible score range"
        },
        "Cutoffs": {
          "type": "object",
          "description": "Clinical cutoff scores and their interpretations",
          "additionalProperties": {"type": "string"}
        },
        "ReverseCodedItems": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of reverse-coded item column names"
        },
        "ReverseCodingScale": {
          "type": "object",
          "description": "Scale bounds used for reverse coding (min/max), if applicable",
          "properties": {
            "min": {"type": ["number", "null"]},
            "max": {"type": ["number", "null"]}
          }
        },
        "CutoffsSource": {
          "type": ["string", "object"],
          "description": "Reference for cutoffs (citation/DOI/URL)"
        },
        "NormsSource": {
          "type": ["string", "object"],
          "description": "Reference for norms (citation/DOI/URL)"
        },
        "Subscales": {
          "type": "array",
          "description": "Optional structured subscale definitions for transparent scoring",
          "items": {
            "type": "object",
            "properties": {
              "Name": {"type": ["string", "object"], "description": "Subscale name"},
              "Items": {"type": "array", "items": {"type": "string"}, "description": "Item IDs contributing to the subscale"},
              "Method": {"type": "string", "enum": ["sum", "mean", "weighted", "custom", ""], "description": "Aggregation method"},
              "Range": {
                "type": "object",
                "properties": {
                  "min": {"type": ["number", "null"]},
                  "max": {"type": ["number", "null"]}
                }
              },
              "ReverseCodedItems": {"type": "array", "items": {"type": "string"}, "description": "Reverse-coded items within this subscale"},
              "Note": {"type": ["string", "object"], "description": "Notes about scoring or interpretation"}
            }
          }
        }
      }
    },
    "Normative": {
      "type": "object",
      "description": "Normative data and reference values",
      "properties": {
        "ReferencePopulation": {
          "type": "string",
          "description": "Population on which normative data is based"
        },
        "ReferenceSource": {
          "type": "string",
          "description": "Citation for normative data"
        },
        "Percentiles": {
          "type": "object",
          "description": "Percentile cutoffs (e.g., {'p25': 10, 'p50': 15, 'p75': 20})"
        }
      }
    },
    "Metadata": {
      "type": "object",
      "description": "Administrative metadata",
      "properties": {
        "SchemaVersion": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "CreationDate": {
          "type": "string",
          "pattern": "^(\\d{4}-\\d{2}-\\d{2})?$",
          "description": "Date of creation"
        },
        "Creator": {
          "type": "string"
        }
      },
      "required": ["SchemaVersion", "CreationDate"]
    }
  },
  "required": ["Technical", "Study", "Metadata"],
  "additionalProperties": {
    "type": "object",
    "properties": {
      "Description": {
        "type": ["string", "object"],
        "description": "The exact question text presented to the participant"
      },
      "Levels": {
        "type": "object",
        "description": "Mapping of numeric values to text labels",
        "patternProperties": {
          "^.*$": { "type": ["string", "object"] }
        }
      },
      "Unit": {
        "type": "string",
        "description": "Unit of measurement (if applicable)"
      },
      "Units": {
        "type": "string",
        "description": "Unit of measurement (if applicable)"
      },
      "TermURL": {
        "type": "string",
        "description": "URL to a definition of the term"
      },
      "Relevance": {
        "type": "string",
        "description": "Logic/Relevance equation for this item (e.g., Q01 == 1)"
      },
      "MinValue": {
        "type": ["number", "null"],
        "description": "Minimum allowed value for this column"
      },
      "MaxValue": {
        "type": ["number", "null"],
        "description": "Maximum allowed value for this column"
      },
      "WarnMinValue": {
        "type": ["number", "null"],
        "description": "Minimum value threshold for warning"
      },
      "WarnMaxValue": {
        "type": ["number", "null"],
        "description": "Maximum value threshold for warning"
      },
      "AllowedValues": {
        "type": "array",
        "items": {
          "type": ["string", "number"]
        },
        "description": "List of allowed values for this column"
      },
      "DataType": {
        "type": "string",
        "enum": ["string", "integer", "float", ""],
        "description": "Expected data type for this column"
      },
      "SessionHint": {
        "type": "string",
        "pattern": "^(ses-[a-zA-Z0-9]+)?$",
        "description": "Optional session hint for repeated assessments (e.g., 'ses-1')"
      },
      "RunHint": {
        "type": "string",
        "pattern": "^(run-[a-zA-Z0-9]+)?$",
        "description": "Optional run hint for repeated assessments (e.g., 'run-2')"
      }
    },
    "required": ["Description"]
  }
}
