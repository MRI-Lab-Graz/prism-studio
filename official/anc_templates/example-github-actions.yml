# Example GitHub Actions Workflow for Dataset Validation
#
# This file is a TEMPLATE. To use it in your exported dataset:
# 1. Create `.github/workflows/` directory in your dataset
# 2. Copy this file to `.github/workflows/validate.yml`
# 3. Customize as needed
# 4. Push to GitHub
#
# Generated by PRISM Studio AND Export

name: Dataset Validation

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  bids-validation:
    name: BIDS Validator
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: Install BIDS Validator
        run: npm install -g bids-validator@latest
      
      - name: Run BIDS Validator
        run: |
          bids-validator . --config .bids-validator-config.json --verbose | tee bids-validator.log
        continue-on-error: true
      
      - name: Upload validation report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: bids-validation-report
          path: bids-validator.log
          retention-days: 30

  prism-validation:
    name: PRISM Validator
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install PRISM Studio
        run: pip install git+https://github.com/MRI-Lab-Graz/prism-studio.git@main
      
      - name: Run PRISM Validator
        run: |
          python -m prism . --output prism_validation_report.txt
          cat prism_validation_report.txt
        continue-on-error: true
      
      - name: Upload report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: prism-validation-report
          path: prism_validation_report.txt
          retention-days: 30

  structure-check:
    name: Check Dataset Structure
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check required files
        run: |
          required=(dataset_description.json participants.tsv)
          for file in "${required[@]}"; do
            [ -f "$file" ] && echo "✓ $file" || { echo "✗ Missing $file"; exit 1; }
          done
