# Example GitLab CI/CD Pipeline for AND Dataset Validation
#
# This file is a TEMPLATE. To use it in your exported dataset:
# 1. Copy this file to your dataset root as `.gitlab-ci.yml`
# 2. Customize the stages and jobs as needed
# 3. Push to your GitLab repository
#
# Generated by PRISM Studio AND Export

stages:
  - format
  - validate
  - publish

variables:
  PRISM_VERSION: "1.9.1"
  BIDS_VALIDATOR_VERSION: "1.14.13"
  PYTHON_VERSION: "3.11"

# ============================================================================
# BIDS Validation
# ============================================================================

validate_bids:
  stage: validate
  image: node:18-slim
  before_script:
    - npm install -g bids-validator@${BIDS_VALIDATOR_VERSION}
  script:
    - echo "Running BIDS validator..."
    - bids-validator . --config .bids-validator-config.json --verbose
  artifacts:
    when: always
    paths:
      - bids-validator.log
    expire_in: 1 week
  only:
    - merge_requests
    - main
    - master

validate_prism:
  stage: validate
  image: python:${PYTHON_VERSION}
  before_script:
    - pip install --upgrade pip
    - pip install git+https://github.com/MRI-Lab-Graz/prism-studio.git@main
  script:
    - echo "Running PRISM validator..."
    - python -m prism . --output prism_validation_report.txt
    - cat prism_validation_report.txt
  artifacts:
    when: always
    paths:
      - prism_validation_report.txt
    expire_in: 1 week
  only:
    - merge_requests
    - main
    - master

# ============================================================================
# Optional: ANC-specific components
# Uncomment and customize if using AND infrastructure
# ============================================================================

# include:
#   - component: $CI_SERVER_FQDN/ci-components/format-components/bids-validator@main
#   - component: $CI_SERVER_FQDN/ci-components/template-validator/template-validator@main
#   - component: $CI_SERVER_FQDN/ci-components/bids-dataset-website/dataset-website@main
