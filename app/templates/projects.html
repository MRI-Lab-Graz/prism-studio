{% extends "base.html" %}

{% block title %}PRISM Studio - Projects{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/projects.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <h2><i class="fas fa-folder-open text-primary me-2"></i>Project Manager</h2>
            <p class="text-muted">Create new PRISM/BIDS projects or validate existing ones.</p>
            <div class="form-check form-switch mt-2">
                <input class="form-check-input" type="checkbox" role="switch" id="beginnerHelpModeToggle">
                <label class="form-check-label" for="beginnerHelpModeToggle">
                    <i class="fas fa-graduation-cap me-1 text-info"></i>Beginner help mode (global setting: show guidance under fields)
                </label>
            </div>
        </div>
    </div>

    {% if current_project.path %}
    <!-- Current Project Banner -->
    <div class="alert alert-success d-flex align-items-center mb-4" role="alert" id="currentProjectBanner">
        <i class="fas fa-check-circle me-3 fa-lg"></i>
        <div class="flex-grow-1">
            <strong>Current Working Project:</strong> {{ current_project.name }}
            <br><code class="small">{{ current_project.path }}</code>
        </div>
        <a href="{{ url_for('validation.validate_dataset') }}" class="btn btn-sm btn-outline-success me-2">
            <i class="fas fa-check-circle me-1"></i>Validate
        </a>
        <button type="button" class="btn btn-sm btn-outline-secondary" id="clearCurrentProjectBtn">
            <i class="fas fa-times"></i>
        </button>
    </div>
    {% endif %}

    <!-- Project Type Selection -->
    <div class="row mb-4">
        <div class="col-md-6 mb-3">
            <div class="project-card" id="card-create">
                <i class="fas fa-plus-circle text-success"></i>
                <h5>Create New Project</h5>
                <p>Set up a new PRISM/BIDS-compatible folder structure</p>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="project-card" id="card-open">
                <i class="fas fa-folder-open text-primary"></i>
                <h5>Open Existing Project</h5>
                <p>Validate and repair an existing project structure</p>
            </div>
        </div>
    </div>

    <!-- Form Sections -->
    {% include 'includes/projects/page_sections.html' %}

</div>
{% endblock %}

{% block scripts %}
<!-- ES6 Module aggregator (new modular architecture) -->
<script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>

<!-- Shared legacy scripts (non-modular) -->
<script src="{{ url_for('static', filename='js/neurobagel.js') }}"></script>

<script>
    // Template variables - must be rendered server-side
    window.currentProjectPath = "{{ current_project.path or '' }}";
    window.currentProjectName = "{{ current_project.name or '' }}";
</script>
{% endblock %}
