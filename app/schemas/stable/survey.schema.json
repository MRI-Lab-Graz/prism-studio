{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://prism.org/schemas/survey/v1.1.1",
  "version": "1.1.1",
  "title": "Survey Data Metadata",
  "description": "Schema for questionnaire and survey data. Files should be named: sub-<label>[_ses-<label>]_survey-<label>[_acq-<label>][_run-<index>]_survey.<tsv|json>",
  "type": "object",
  "properties": {
    "Technical": {
      "type": "object",
      "description": "Technical survey properties",
      "properties": {
        "StimulusType": {
          "type": "string",
          "enum": ["Questionnaire", ""],
          "description": "Must be 'Questionnaire' for survey data"
        },
        "FileFormat": {
          "type": "string",
          "enum": ["tsv", ""],
          "description": "Survey data file format"
        },
        "SoftwarePlatform": {
          "type": "string",
          "description": "Software platform used for data collection (e.g., LimeSurvey, REDCap, Qualtrics)"
        },
        "SoftwareVersion": {
          "type": "string",
          "description": "Version of the survey software platform"
        },
        "Language": {
          "type": "string",
          "pattern": "^([a-z]{2}(-[A-Z]{2})?)?$",
          "description": "Language of the questionnaire (e.g., en, en-US, de-AT)"
        },
        "Respondent": {
          "type": "string",
          "enum": ["self", "clinician", "parent", "teacher", "caregiver", "other", ""],
          "description": "Who provided the responses"
        },
        "AdministrationMethod": {
          "type": "string",
          "enum": ["online", "paper", "interview", "phone", "mixed", ""],
          "description": "How the survey was administered"
        },
        "Equipment": {
          "type": ["string", "object"],
          "description": "Equipment used for measurement (e.g., Stopwatch, Cycle Ergometer, Dynamometer)"
        },
        "EquipmentManufacturer": {
          "type": "string",
          "description": "Manufacturer of the equipment"
        },
        "EquipmentModel": {
          "type": "string", 
          "description": "Model name/number of the equipment"
        },
        "CalibrationDate": {
          "type": "string",
          "pattern": "^(\\d{4}-\\d{2}-\\d{2})?$",
          "description": "Date of last equipment calibration"
        },
        "Supervisor": {
          "type": "string",
          "enum": ["investigator", "physician", "trainer", "physiotherapist", "self", ""],
          "description": "Who supervised the assessment"
        },
        "Location": {
          "type": "string",
          "enum": ["laboratory", "clinic", "gym", "field", "home", ""],
          "description": "Where the assessment was conducted"
        }
      },
      "required": ["StimulusType", "FileFormat", "Language", "Respondent"]
    },
    "I18n": {
      "type": "object",
      "description": "Internationalization settings for multi-language surveys",
      "properties": {
        "Languages": {
          "type": "array",
          "items": {"type": "string", "pattern": "^([a-z]{2}(-[A-Z]{2})?)?$"},
          "description": "List of available languages (e.g., ['en', 'de', 'fr'])"
        },
        "DefaultLanguage": {
          "type": "string",
          "pattern": "^([a-z]{2}(-[A-Z]{2})?)?$",
          "description": "Default/primary language of the instrument"
        },
        "TranslationMethod": {
          "type": "string",
          "enum": ["forward-backward", "committee", "parallel", "original", "validated-translation", ""],
          "description": "Method used for translation validation"
        }
      }
    },
    "Study": {
      "type": "object",
      "description": "Study-specific survey parameters",
      "properties": {
        "TaskName": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9]*$",
          "description": "Short task identifier matching filename (e.g., bdi, phq9, dass21)"
        },
        "OriginalName": {
          "type": ["string", "object"],
          "description": "Full canonical name of the instrument (e.g., Beck Depression Inventory)"
        },
        "ShortName": {
          "type": ["string", "object"],
          "description": "Common abbreviation (e.g., BDI-II, PHQ-9)"
        },
        "Version": {
          "type": ["string", "object"],
          "description": "Version of the instrument (e.g., II, 5.0, 21-item)"
        },
        "Authors": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Authors of the instrument"
        },
        "Citation": {
          "type": "string",
          "description": "DOI or citation for the instrument"
        },
        "DOI": {
          "type": "string",
          "description": "Digital Object Identifier (DOI) for the instrument; use the canonical DOI string (10.x/...) without protocol prefixes or leave empty when unavailable",
          "pattern": "^(?:10\\.\\d{4,9}/\\S+)?$"
        },
        "License": {
          "type": "string",
          "description": "License statement for this instrument as provided by the source registry"
        },
        "LicenseID": {
          "type": "string",
          "description": "Normalized license identifier (prefer SPDX or Creative Commons identifiers)",
          "enum": [
            "CC-BY-4.0",
            "CC-BY-SA-4.0",
            "CC-BY-ND-4.0",
            "CC-BY-NC-4.0",
            "CC-BY-NC-SA-4.0",
            "CC-BY-NC-ND-4.0",
            "MIT",
            "Apache-2.0",
            "GPL-3.0-only",
            "GPL-3.0-or-later",
            "LGPL-3.0-only",
            "BSD-3-Clause",
            "Unlicense",
            "PDDL-1.0",
            "CC0-1.0"
          ]
        },
        "LicenseURL": {
          "type": "string",
          "format": "uri",
          "description": "License URL when available (e.g., creativecommons.org link)"
        },
        "CopyrightHolder": {
          "type": "string",
          "description": "Rights holder for the instrument (e.g., publisher, author group)"
        },
        "Access": {
          "type": "string",
          "enum": ["public", "permission-required", "licensed", "unknown", ""],
          "description": "High-level access/permission classification for transparency"
        },
        "PermissionsNote": {
          "type": ["string", "object"],
          "description": "Short note describing permissions/usage constraints"
        },
        "PermissionsURL": {
          "type": "string",
          "description": "URL to permission statement or licensing portal"
        },
        "TermURL": {
          "type": "string",
          "format": "uri",
          "description": "URL to formal definition (e.g., PhenX, SNOMED)"
        },
        "Construct": {
          "type": ["string", "object"],
          "description": "Primary psychological construct measured (e.g., depression, anxiety, stress)"
        },
        "Keywords": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Keywords describing the instrument"
        },
        "Description": {
          "type": ["string", "object"],
          "description": "Detailed description or abstract of the instrument"
        },
        "Instructions": {
          "type": ["string", "object"],
          "description": "Instructions given to the participant"
        },
        "Reliability": {
          "type": ["string", "object"],
          "description": "Information about the reliability of the instrument"
        },
        "Validity": {
          "type": ["string", "object"],
          "description": "Information about the validity of the instrument"
        },
        "Subscales": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of subscale names if applicable"
        },
        "ItemCount": {
          "type": ["integer", "null"],
          "description": "Number of items in the instrument"
        },
        "AgeRange": {
          "type": "object",
          "description": "Target age range for the instrument in years",
          "properties": {
            "min": { "type": "number", "description": "Minimum age in years" },
            "max": { "type": "number", "description": "Maximum age in years" }
          },
          "required": ["min", "max"],
          "additionalProperties": false,
          "examples": [{ "min": 18, "max": 99 }]
        },
        "AdministrationTime": {
          "type": "object",
          "description": "Estimated time to complete the instrument in minutes",
          "properties": {
            "min": { "type": "number", "description": "Minimum estimated minutes" },
            "max": { "type": "number", "description": "Maximum estimated minutes" }
          },
          "required": ["min", "max"],
          "additionalProperties": false,
          "examples": [{ "min": 10, "max": 15 }]
        },
        "ScoringTime": {
          "type": "object",
          "description": "Estimated time to score the instrument in minutes",
          "properties": {
            "min": { "type": "number", "description": "Minimum estimated minutes" },
            "max": { "type": "number", "description": "Maximum estimated minutes" }
          },
          "required": ["min", "max"],
          "additionalProperties": false,
          "examples": [{ "min": 5, "max": 5 }]
        },
        "Norming": {
          "type": ["string", "object"],
          "description": "Information about the norming of the instrument"
        },
        "References": {
          "type": "array",
          "description": "Structured reference list for the instrument (primary paper, manual, translation, norms, validation, etc.)",
          "items": {
            "type": "object",
            "properties": {
              "Type": {
                "type": "string",
                "enum": ["primary", "manual", "translation", "validation", "norms", "other", ""],
                "description": "Reference type"
              },
              "Citation": {
                "type": "string",
                "description": "Human-readable citation"
              },
              "DOI": {
                "type": "string",
                "description": "DOI for the reference (canonical 10.x/... string) or empty when unavailable",
                "pattern": "^(?:10\\.\\d{4,9}/\\S+)?$"
              },
              "URL": {
                "type": "string",
                "description": "URL for the reference",
                "format": "uri"
              },
              "Year": {
                "type": ["integer", "null"],
                "description": "Publication year"
              },
              "Notes": {
                "type": ["string", "object"],
                "description": "Optional notes about the reference"
              }
            },
            "required": ["Type"],
            "additionalProperties": false,
            "examples": [
              {
                "Type": "primary",
                "Citation": "Hautzinger, M., & Bailer, M. (1993). Allgemeine Depressionsskala (ADS).",
                "DOI": "10.1007/978-3-642-34523-1",
                "URL": "https://doi.org/10.1007/978-3-642-34523-1",
                "Year": 1993,
                "Notes": {
                  "en": "Original ADS manual"
                }
              }
            ]
          }
        },
        "Translation": {
          "type": "object",
          "description": "Translation/adaptation provenance (especially for non-original language versions)",
          "properties": {
            "SourceLanguage": {
              "type": "string",
              "pattern": "^([a-z]{2}(-[A-Z]{2})?)?$",
              "description": "Source language of the instrument"
            },
            "TargetLanguage": {
              "type": "string",
              "pattern": "^([a-z]{2}(-[A-Z]{2})?)?$",
              "description": "Target language used in this dataset"
            },
            "Validated": {
              "type": "boolean",
              "description": "Whether this translation/adaptation is validated"
            },
            "Method": {
              "type": "string",
              "description": "Translation/adaptation method (if different from I18n.TranslationMethod)"
            },
            "Reference": {
              "type": "string",
              "description": "Citation/DOI/URL for the translation/adaptation reference"
            },
            "Notes": {
              "type": ["string", "object"],
              "description": "Additional provenance notes"
            }
          }
        }
      },
      "required": ["TaskName", "OriginalName"]
    },
    "Normative": {
      "type": "object",
      "description": "Normative data and reference values",
      "properties": {
        "ReferencePopulation": {
          "type": "string",
          "description": "Population on which normative data is based"
        },
        "ReferenceSource": {
          "type": "string",
          "description": "Citation for normative data"
        },
        "Percentiles": {
          "type": "object",
          "description": "Percentile cutoffs (e.g., {'p25': 10, 'p50': 15, 'p75': 20})"
        }
      }
    },
    "Metadata": {
      "type": "object",
      "description": "Administrative metadata",
      "properties": {
        "SchemaVersion": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "CreationDate": {
          "type": "string",
          "pattern": "^(\\d{4}-\\d{2}-\\d{2})?$",
          "description": "Date of creation"
        },
        "Creator": {
          "type": "string"
        }
      },
      "required": ["SchemaVersion", "CreationDate"]
    }
  },
  "required": ["Technical", "Study", "Metadata"],
  "additionalProperties": {
    "type": "object",
    "properties": {
      "Description": {
        "type": ["string", "object"],
        "description": "The exact question text presented to the participant"
      },
      "AliasOf": {
        "type": "string",
        "description": "Column name of the canonical item this is an alias for (used during conversion)"
      },
      "Aliases": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Alternative column names that use this same definition"
      },
      "Levels": {
        "type": "object",
        "description": "Mapping of numeric values to text labels",
        "patternProperties": {
          "^.*$": { "type": ["string", "object"] }
        }
      },
      "Unit": {
        "type": "string",
        "description": "Unit of measurement (if applicable)"
      },
      "Units": {
        "type": "string",
        "description": "Unit of measurement (if applicable)"
      },
      "TermURL": {
        "type": "string",
        "description": "URL to a definition of the term"
      },
      "Relevance": {
        "type": "string",
        "description": "Logic/Relevance equation for this item (e.g., Q01 == 1)"
      },
      "MinValue": {
        "type": ["number", "null"],
        "description": "Minimum allowed value for this column"
      },
      "MaxValue": {
        "type": ["number", "null"],
        "description": "Maximum allowed value for this column"
      },
      "WarnMinValue": {
        "type": ["number", "null"],
        "description": "Minimum value threshold for warning"
      },
      "WarnMaxValue": {
        "type": ["number", "null"],
        "description": "Maximum value threshold for warning"
      },
      "AllowedValues": {
        "type": "array",
        "items": {
          "type": ["string", "number"]
        },
        "description": "List of allowed values for this column"
      },
      "DataType": {
        "type": "string",
        "enum": ["string", "integer", "float", ""],
        "description": "Expected data type for this column"
      },
      "SessionHint": {
        "type": "string",
        "pattern": "^(ses-[a-zA-Z0-9]+)?$",
        "description": "Optional session hint for repeated assessments (e.g., 'ses-1')"
      },
      "RunHint": {
        "type": "string",
        "pattern": "^(run-[a-zA-Z0-9]+)?$",
        "description": "Optional run hint for repeated assessments (e.g., 'run-2')"
      }
    },
    "anyOf": [
      { "required": ["Description"] },
      { "required": ["AliasOf"] }
    ]
  }
}
