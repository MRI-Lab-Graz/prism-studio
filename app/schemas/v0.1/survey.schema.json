{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://prism.org/schemas/survey/v1.1.0",
  "version": "1.1.0",
  "title": "Survey Data Metadata",
  "description": "Schema for questionnaire and survey data. Files should be named: sub-<label>[_ses-<label>]_survey-<label>[_acq-<label>][_run-<index>]_survey.<tsv|json>",
  "type": "object",
  "properties": {
    "Technical": {
      "type": "object",
      "description": "Technical survey properties",
      "properties": {
        "StimulusType": {
          "type": "string",
          "enum": ["Questionnaire"],
          "description": "Must be 'Questionnaire' for survey data"
        },
        "FileFormat": {
          "type": "string",
          "enum": ["tsv"],
          "description": "Survey data file format"
        },
        "SoftwarePlatform": {
          "type": "string",
          "description": "Software platform used for data collection (e.g., LimeSurvey, REDCap, Qualtrics)"
        },
        "SoftwareVersion": {
          "type": "string",
          "description": "Version of the survey software platform"
        },
        "Language": {
          "type": "string",
          "pattern": "^[a-z]{2}(-[A-Z]{2})?$",
          "description": "Language of the questionnaire (e.g., en, en-US, de-AT)"
        },
        "Respondent": {
          "type": "string",
          "enum": ["self", "clinician", "parent", "teacher", "caregiver", "other"],
          "description": "Who provided the responses"
        },
        "AdministrationMethod": {
          "type": "string",
          "enum": ["online", "paper", "interview", "phone", "mixed"],
          "description": "How the survey was administered"
        }
      },
      "required": ["StimulusType", "FileFormat", "Language", "Respondent"]
    },
    "I18n": {
      "type": "object",
      "description": "Internationalization settings for multi-language surveys",
      "properties": {
        "Languages": {
          "type": "array",
          "items": {"type": "string", "pattern": "^[a-z]{2}(-[A-Z]{2})?$"},
          "description": "List of available languages (e.g., ['en', 'de', 'fr'])"
        },
        "DefaultLanguage": {
          "type": "string",
          "pattern": "^[a-z]{2}(-[A-Z]{2})?$",
          "description": "Default/primary language of the instrument"
        },
        "TranslationMethod": {
          "type": "string",
          "enum": ["forward-backward", "committee", "parallel", "original", "validated-translation"],
          "description": "Method used for translation validation"
        }
      }
    },
    "Study": {
      "type": "object",
      "description": "Study-specific survey parameters",
      "properties": {
        "TaskName": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9]+$",
          "description": "Short task identifier matching filename (e.g., bdi, phq9, dass21)"
        },
        "OriginalName": {
          "type": "string",
          "description": "Full canonical name of the instrument (e.g., Beck Depression Inventory)"
        },
        "ShortName": {
          "type": "string",
          "description": "Common abbreviation (e.g., BDI-II, PHQ-9)"
        },
        "Version": {
          "type": "string",
          "description": "Version of the instrument (e.g., II, 5.0, 21-item)"
        },
        "Citation": {
          "type": "string",
          "description": "DOI or citation for the instrument"
        },
        "TermURL": {
          "type": "string",
          "format": "uri",
          "description": "URL to formal definition (e.g., PhenX, SNOMED)"
        },
        "Construct": {
          "type": "string",
          "description": "Primary psychological construct measured (e.g., depression, anxiety, stress)"
        },
        "Subscales": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of subscale names if applicable"
        }
      },
      "required": ["TaskName", "OriginalName"]
    },
    "Metadata": {
      "type": "object",
      "description": "Administrative metadata",
      "properties": {
        "SchemaVersion": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "CreationDate": {
          "type": "string",
          "format": "date"
        },
        "Creator": {
          "type": "string"
        }
      },
      "required": ["SchemaVersion", "CreationDate"]
    }
  },
  "required": ["Technical", "Study", "Metadata"],
  "additionalProperties": {
    "type": "object",
    "properties": {
      "Description": {
        "type": "string",
        "description": "The exact question text presented to the participant"
      },
      "AliasOf": {
        "type": "string",
        "description": "If this item is just another name for an existing item, specify the canonical item ID here. Use when the same question appears with different IDs in your data (e.g., 'depression_q1' â†’ 'phq9_q1'). Leave empty for canonical items."
      },
      "Levels": {
        "type": "object",
        "description": "Mapping of numeric values to text labels",
        "patternProperties": {
          "^.*$": { "type": "string" }
        }
      },
      "Units": {
        "type": "string",
        "description": "Unit of measurement (if applicable)"
      },
      "TermURL": {
        "type": "string",
        "format": "uri",
        "description": "URL to a definition of the term"
      },
      "Relevance": {
        "type": "string",
        "description": "Logic/Relevance equation for this item (e.g., Q01 == 1)"
      },
      "MinValue": {
        "type": "number",
        "description": "Minimum allowed value for this column"
      },
      "MaxValue": {
        "type": "number",
        "description": "Maximum allowed value for this column"
      },
      "WarnMinValue": {
        "type": "number",
        "description": "Minimum value threshold for warning"
      },
      "WarnMaxValue": {
        "type": "number",
        "description": "Maximum value threshold for warning"
      },
      "AllowedValues": {
        "type": "array",
        "items": {
          "type": ["string", "number"]
        },
        "description": "List of allowed values for this column"
      },
      "DataType": {
        "type": "string",
        "enum": ["string", "integer", "float"],
        "description": "Expected data type for this column"
      }
    },
    "required": ["Description"]
  }
}
